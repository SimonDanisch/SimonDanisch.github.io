---
layout: post
---
<h1>Gadfly Points</h1>
<img src="gadfly_points.png" alt="gadfly" width="480" height="300">
{% highlight julia %}
w,r = glscreen()
img = GLVisualizeBackend(w)
p   = plot(x=rand(100), y=rand(100))
draw(img, p)
r()
{% endhighlight %}

<h1>Gadfly Lines</h1>
<img src="gadfly_sin.png" alt="gadfly" width="480" height="300">
{% highlight julia %}
w,r = glscreen()
img = GLVisualizeBackend(w)
p   = plot([sin, cos], 0, 25)
draw(img, p)
r()
{% endhighlight %}

<h1>Gadfly Histogram</h1>
<img src="gadfly_bars.png" alt="gadfly" width="480" height="300">
{% highlight julia %}
w,r = glscreen()
img = GLVisualizeBackend(w)
p   = plot(dataset("car", "SLID"), x="Wages", color="Language", Geom.histogram)
draw(img, p)
r()
{% endhighlight %}

<h1>Surface Mesh</h1>
<video  width="480" height="300" autoplay loop>
  <source src="surfacemesh.webm">
      Your browser does not support the video tag.
</video>

{% highlight julia %}
dphi, dtheta = pi/200.0f0, pi/200.0f0
function mgrid(dim1, dim2)
    X = [i for i in dim1, j in dim2]
    Y = [j for i in dim1, j in dim2]
    return X,Y
end
phi,theta = mgrid(0f0:dphi:(pi+dphi*1.5f0), 0f0:dtheta:(2f0*pi+dtheta*1.5f0));
m0 = 4f0; m1 = 3f0; m2 = 2f0; m3 = 3f0; m4 = 6f0; m5 = 2f0; m6 = 6f0; m7 = 4f0;
a = sin(m0*phi).^m1
b = cos(m2*phi).^m3
c = sin(m4*theta).^m5
d = cos(m6*theta).^m7
r = a + b + c + d
x = r.*sin(phi).*cos(theta)
y = r.*cos(phi)
z = r.*sin(phi).*sin(theta)
view(visualize((x,y,z), :surface))
{% endhighlight %}

<h1>3D Particles</h1>
<video  width="480" height="300" autoplay loop>
  <source src="cats.webm">
Your browser does not support the video tag.
</video>

{% highlight julia %}
cat    = load("cat.obj")
sphere = GLNormalMesh(Sphere(Vec3f0(0), 1f0), 12)
function scale_gen(v0, nv)
	l = length(v0)
	for i=1:l
		v0[i] = Vec3f0(1,1,sin((nv*l)/i))/2
	end
	v0
end
function color_gen(v0, nv)
	l = length(v0)
	for x=1:l
		v0[x] = RGBA{U8}(x/l,(cos(nv)+1)/2,(sin(x/l/3)+1)/2.,1.)
	end

	v0
end
t            = bounce(0:0.1:10)
ps           = sphere.vertices
scale_start  = Vec3f0[Vec3f0(1,1,rand()) for i=1:length(ps)]
scale_signal = foldp(scale_gen, scale_start, t)
scale        = scale_signal

color_signal = foldp(color_gen, zeros(RGBA{U8}, length(ps)), t)
color        = color_signal
rotation     = -sphere.normals
a = visualize((cat, ps), scale=scale, color=color, rotation=rotation)
view(a)
{% endhighlight %}


<h1>Line Segments</h1>
<video  width="480" height="300" autoplay loop>
  <source src="linesegments.webm">
      Your browser does not support the video tag.
</video>

{% highlight julia %}
x         = HyperSphere(Point3f0(0), 1f0)
positions = decompose(Point3f0, x)
indices   = rand(range(Cuint(0), Cuint(length(positions))), 1000)
colorramp = colormap("Blues", length(positions))
color     = map(x->RGBA{Float32}(x, 0.9f0), colorramp)
color2    = map(x->RGBA{Float32}(x, 1f0), colorramp)
view(visualize(positions, :linesegment, thickness=0.5f0, color=color, indices=indices))
view(visualize((Sphere(Point3f0(0.0), 1f0), positions), color=color2, scale=Vec3f0(0.05)))
r()
{% endhighlight %}

<h1>2D Particles</h1>
<video  width="480" height="300" autoplay loop>
  <source src="bouncy.webm">
Your browser does not support the video tag.
</video>

{% highlight julia %}
const border = 50f0
function bounce_particles(pos_velo, _)
    positions, velocity = pos_velo
    dt = 0.1f0
    for i=1:length(positions)
        pos,velo = positions[i], velocity[i]
        positions[i] = Point2f0(pos[1], pos[2] + velo*dt)
        if pos[2] <= border
            velocity[i] = abs(velo)
        else
            velocity[i] = velo - 9.8*dt
        end
    end
    positions, velocity
end
start_position = (rand(Point2f0, n)*700f0) + border
position_velocity = foldp(bounce_particles,
    (start_position, zeros(Float32, n)),
    bounce(1:10)
)
circle = HyperSphere(Point2f0(0), 20f0)
vis = visualize((circle, map(first, position_velocity)),
    image=load("doge.png"),
    stroke_width=1f0,
    stroke_color=RGBA{Float32}(0.91,0.91,0.91,1)
)
view(vis, method=:orthographic_pixel)
{% endhighlight %}

<h1>2D Bars</h1>
<video  width="480" height="300" autoplay loop>
  <source src="bars.webm">
Your browser does not support the video tag.
</video>

{% highlight julia %}
b = rand(10f0:0.01f0:200f0, 10)
interpolate(a,b,t) = [ae+((be-ae)*t) for (ae, be) in zip(a,b)]
interpolated = foldp((b,b,b), bounce(0f0:0.05f0:10f0)) do v0_v1_ip, td
    v0,v1,ip = v0_v1_ip
    pol = td%1
    if isapprox(pol,0.0)
        v0 = v1
        v1 = map(x-> rand(linspace(-50f0, 60f0, 100)), v0)
    end
    v0,v1,interpolate(v0,v1,pol)
end
b_sig = map(last, interpolated)
a     = visualize((RECTANGLE, b_sig),
    xyrange=((0,400),),
    intensity=b_sig,
    color_norm=Vec2f0(-40,200),
    color=Texture(GLVisualize.default(Vector{RGBA}))
)
view(a, method=:orthographic_pixel)
{% endhighlight %}


<h1>Unicode Particles + Rotation</h1>
<video  width="480" height="300" autoplay loop>
  <source src="arrows.webm">
Your browser does not support the video tag.
</video>
{% highlight julia %}
t    = bounce(1.:0.05:(2pi+1))
flow = map(i->Vec2f0[(sin(x/i), cos(y/(i/2f0))) for x=1:20, y=1:20], t)
vis  = visualize(flow, xyrange=((50,800),(50,500)))
view(vis, method=:orthographic_pixel)
{% endhighlight %}

<h1>Unicode Particles, Billboard</h1>
<video  width="480" height="300" autoplay loop>
  <source src="snow.webm">
Your browser does not support the video tag.
</video>
{% highlight julia %}
S = -5f0;W = 10f0;N = 2000
ps = (rand(Point3f0, N)*W)+S
const velocity = rand(Vec3f0, N)*0.01f0
const gravity = Vec3f0(0,0,-0.02)
BT = bounce(1:10)
upper_bound(x) = x>S+W
lower_bound(x) = x<S
function letitsnow(position, t)
  for i=1:length(ps)
    pos = Vec(position[i])
    p = Point3f0(pos+gravity+velocity[i])
    if any(upper_bound, p) || any(lower_bound, p)
      position[i] = Point3f0(rand(linspace(S,S+W, 1000)),rand(linspace(S,S+W, 1000)), S+W)
      velocity[i] = Vec3f0(0)
    else
      position[i] = p
    end
  end
  position
end
particles = foldp(letitsnow, ps, BT)
view(visualize(('â„', particles), scale=Vec2f0(0.2), billboard=true))
{% endhighlight %}


<h1>5 million Billboard Particles</h1>
<img src="mounthelens.jpg" alt="particles" width="480">
{% highlight julia %}
xyz = laz2xyz("Mount St Helens Nov 20 2004.laz");
points = [Point3f0(xyz[i,:]...) for i=1:size(xyz, 1)]
_min = minimum(points)
_max = maximum(points)
w = _max - _min
map!(points) do p
  (p-_min)./w
end
view(visualize((CIRCLE, points), scale=Vec2f0(0.005), billboard=true))
{% endhighlight %}

<h1>Large, geographic Surface</h1>
<img src="geography.png" alt="surface" width="480">
{% highlight julia %}
using GMT, GLVisualize, GLAbstraction, Colors
G     = gmt("gmtread -Tg bathy_1m.nc")
Z     = G.z
maxi  = maximum(Z)
mini  = minimum(Z)
xmin,xmax   = G.x[1], G.x[end]
ymin,ymax   = G.y[1], G.y[end]
#center them
xwidth_half = (xmax-xmin)/2f0
xmin, xmax  = -xwidth_half, xwidth_half
ywidth_half = (ymax-ymin)/2f0
ymin, ymax  = -ywidth_half, ywidth_half
zwidth_half = maxi-mini
Z = (Z - mini) ./ (maxi-mini) #normalize
w,r = glscreen();
colormap = RGBA{U8}[
    RGBA{U8}(0.0,0.08203125,0.96875,1)
    RGBA{U8}(0.03125,0.9375,0.984375,1)
    RGBA{U8}(0.25,0.80078125,0.36328125,1)
    RGBA{U8}(0.87890625,0.91015625,0.1015625,1)
    RGBA{U8}(0.75,0.125,0.0,1)
 ]
robj = visualize(Z, :surface, grid_min=Vec2f0(xmin, ymin), grid_max=Vec2f0(xmax, ymax), color=colormap)
view(robj)
{% endhighlight %}

<h1>Animated Surface</h1>
<video  width="480" height="300" autoplay loop>
  <source src="surface.webm">
Your browser does not support the video tag.
</video>
{% highlight julia %}
function xy_data(x,y,i, N)
	x = ((x/N)-0.5f0)*i
	y = ((y/N)-0.5f0)*i
	r = sqrt(x*x + y*y)
	Float32(sin(r)/r)
end
surf(i, N) = Float32[xy_data(Float32(x),Float32(y),Float32(i), N) for x=1:N, y=1:N]
view(visualize(const_lift(surf, bounce(20f0:0.1f0:80f0), 400), :surface))
{% endhighlight %}
